import streamlit as st
import wikipediaapi

# ---------------------------
# Page Config
<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>About - InMind</title>
<style>
  body, html {
    margin: 0;
    padding: 0;
    height: 100%;
    font-family: "San Francisco Pro", -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
    color: white;
    background-color: black;
    overflow-x: hidden;
    text-align: center;
  }

  /* Fixed background brain image */
  #brain-bg {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;
    opacity: 0;
    transition: opacity 2s ease-in;
    z-index: -1;
  }

  /* Neon glow title */
  #about-title {
    font-family: "Hiragino Mincho ProN", serif;
    font-size: 72px;
    color: white;
    text-shadow: 0 0 5px #f8f8f8, 0 0 10px #f8f8f8, 0 0 20px #f8f8f8, 0 0 30px #f8f8f8;
    opacity: 0;
    transition: opacity 2s ease-in;
    margin-top: 200px;
    position: relative;
  }

  /* Content paragraphs */
  #about-content {
    max-width: 800px;
    margin: 100px auto 50px auto;
    font-size: 20px;
    line-height: 1.8;
  }

  #about-content p {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 1.5s ease-out, transform 1.5s ease-out;
  }

  /* Back to Home button */
  #back-button {
    display: inline-block;
    margin: 50px 0;
    padding: 10px 25px;
    font-family: "Times New Roman", Times, serif;
    font-style: italic;
    font-size: 20px;
    color: white;
    border: 2px solid white;
    border-radius: 5px;
    text-decoration: none;
    opacity: 0;
    transition: opacity 1s ease-in;
  }
</style>
</head>
<body>

  <!-- Brain Background Image -->
  <img id="brain-bg" src="BRAIN_IMAGE_PATH.png" alt="Brain Background">

  <!-- Title -->
  <div id="about-title">About InMind.</div>

  <!-- Content -->
  <div id="about-content">
    <p>InMind is a student-led initiative committed to advancing early awareness, detection, and support for individuals and families affected by neurodegenerative diseases. Founded by a neuroscience-aspiring student with a deep passion for service, InMind seeks to bridge the gap between cutting-edge technology and compassionate care.</p>

    <p>At its core, InMind is driven by two guiding principles: accessibility and empathy. Neurodegenerative conditions such as Alzheimer‚Äôs, Parkinson‚Äôs, and frontotemporal dementia often go unnoticed until they significantly disrupt quality of life. InMind aims to empower individuals by providing early-stage tools and knowledge before diagnosis becomes overwhelming and while intervention can still be impactful.</p>

    <p>The platform works by allowing users to ask questions about brain health. The AI tool searches trusted sources, summarizes information, and presents it in a concise and accessible way. In addition to the AI tool, InMind offers a curated hub of resources covering prevention strategies, caregiving guidance, and community support. Users can explore frequently asked questions with a single click or submit their own questions through the chat interface. The platform also allows users to save information as favorites for future reference and clear the chat to start a new session.</p>

    <p>Using InMind is straightforward. Users can start by exploring the pre-selected questions or typing a question in the chat. The AI will generate a clear summary based on reliable sources. Favorites can be saved to quickly access important information later. The resources hub provides guides and materials for prevention, caregiving, and community engagement. These features are designed to give users control over their learning experience and make brain health knowledge accessible to everyone.</p>
  </div>

  <!-- Back to Home Button -->
  <a id="back-button" href="index.html">Back to Home</a>

<script>
  const brain = document.getElementById('brain-bg');
  const title = document.getElementById('about-title');
  const contentParagraphs = document.querySelectorAll('#about-content p');
  const backBtn = document.getElementById('back-button');

  // Fade in brain and title
  window.addEventListener('load', () => {
    setTimeout(() => { brain.style.opacity = 1; }, 500);
    setTimeout(() => { title.style.opacity = 1; }, 1200);
  });

  // Scroll event for parallax and staggered fade-in
  window.addEventListener('scroll', () => {
    const scrollY = window.scrollY;

    // Parallax title movement
    title.style.transform = `translateY(-${scrollY * 0.3}px)`;

    // Fade in paragraphs one by one as they enter view
    contentParagraphs.forEach((p, index) => {
      const rect = p.getBoundingClientRect();
      const screenHeight = window.innerHeight;
      if (rect.top < screenHeight * 0.9) {
        p.style.opacity = 1;
        p.style.transform = 'translateY(0)';
        p.style.transitionDelay = `${index * 0.3}s`;
      }
    });

    // Show back button near bottom
    if ((window.innerHeight + scrollY) >= document.body.offsetHeight - 50) {
      backBtn.style.opacity = 1;
    } else {
      backBtn.style.opacity = 0;
    }
  });
</script>

</body>
</html>
st.set_page_config(
    page_title="üß† InMind",
    page_icon="üß†",
    layout="centered"
)

# ---------------------------
# Initialize Session State
# ---------------------------
if "messages" not in st.session_state:
    st.session_state.messages = []
if "favorites" not in st.session_state:
    st.session_state.favorites = []
if "last_wiki" not in st.session_state:
    st.session_state.last_wiki = None

# ---------------------------
# FAQ Buttons
# ---------------------------
faq_buttons = [
    ("What causes dementia?", "dementia"),
    ("What are the early signs of Alzheimer‚Äôs?", "alzheimer"),
    ("How can stroke affect memory?", "stroke"),
    ("What are the symptoms of Parkinson‚Äôs?", "parkinson"),
]

# ---------------------------
# Wikipedia API Setup
# ---------------------------
wiki_wiki = wikipediaapi.Wikipedia("en")

# ---------------------------
# Helper Function with Caching
# ---------------------------
@st.cache_data(show_spinner=False)
def cached_wikipedia_query(prompt: str, topic_key: str = None, max_chars: int = 900):
    try:
        canonical_topics = {
            "dementia": "Dementia",
            "alzheimer": "Alzheimer's disease",
            "stroke": "Stroke",
            "parkinson": "Parkinson's disease",
            "memory loss": "Amnesia",
        }

        page_title = canonical_topics.get(topic_key, prompt)
        page = wiki_wiki.page(page_title)

        if not page.exists():
            return None

        summary = page.summary
        if len(summary) > max_chars:
            summary = summary[:max_chars].rsplit(".", 1)[0] + "..."

        return {
            "title": page.title,
            "summary": summary,
            "url": page.fullurl
        }
    except Exception:
        return None

# ---------------------------
# Header with Logo
# ---------------------------
try:
    st.image("LOGO_PATH.png", width=120)
except Exception:
    st.write("üß† InMind")  # fallback text if logo fails to load

# ---------------------------
# FAQ Section
# ---------------------------
st.subheader("Common Questions")
faq_col1, faq_col2 = st.columns(2)
for i, (label, topic_key) in enumerate(faq_buttons):
    clicked = False
    if i % 2 == 0:
        clicked = faq_col1.button(label)
    else:
        clicked = faq_col2.button(label)

    if clicked:
        wiki = cached_wikipedia_query(label, topic_key=topic_key)
        if wiki:
            st.session_state.messages.append(("assistant", wiki["summary"]))
            st.session_state.last_wiki = wiki
        else:
            st.session_state.messages.append(("assistant", "Sorry, I couldn‚Äôt find information on that."))

# ---------------------------
# Chat Input
# ---------------------------
user_input = st.chat_input("Ask about brain health...")
if user_input:
    st.session_state.messages.append(("user", user_input))
    wiki = cached_wikipedia_query(user_input)
    if wiki:
        st.session_state.messages.append(("assistant", wiki["summary"]))
        st.session_state.last_wiki = wiki
    else:
        st.session_state.messages.append(("assistant", "Sorry, I couldn‚Äôt find information on that."))

# ---------------------------
# Chat Display
# ---------------------------
for role, msg in st.session_state.messages:
    if role == "user":
        st.chat_message("user").write(msg)
    else:
        st.chat_message("assistant").write(msg)

# ---------------------------
# Buttons (Favorites, Clear)
# ---------------------------
btn_col1, btn_col2 = st.columns(2)
if btn_col1.button("‚≠ê Favorite"):
    if st.session_state.last_wiki and st.session_state.last_wiki not in st.session_state.favorites:
        st.session_state.favorites.append(st.session_state.last_wiki)

if btn_col2.button("üóëÔ∏è Clear Chat"):
    st.session_state.messages = []
    st.session_state.last_wiki = None
    st.session_state.favorites = []
    st.experimental_rerun()

# ---------------------------
# Favorites Display
# ---------------------------
if st.session_state.favorites:
    st.subheader("‚≠ê Favorites")
    for fav in st.session_state.favorites:
        st.markdown(f"**[{fav['title']}]({fav['url']})** - {fav['summary']}")
